# Python课程大作业说明文档

[TOC]

## 1. 项目名称

基于Python的智能监控平台

项目地址：https://github.com/wuhaixu2016/web-backend

## 2. 配置说明

#### 2.1 运行及测试环境 

- 电脑环境：win10  处理器：i7-5500U 
- 测试软件：google chrome 68.0.3440.106

#### 2.2 配置说明 

```python
- python: 3.5.2
- django: 2.1.1
- easydict: 1.8
- image: 1.5.24
- Keras: 2.2.2
- matplotlib: 2.2.3
- numpy: 1.14.5+mkl
- Pillow: 5.1.0
- torch: 0.4.0
```

## 3. 功能说明

项目实现了**作业文档中的所有要求及加分项**，同时还实现了**报警功能**。下面是具体的功能介绍：

####3.1 ⽹站访问鉴权

- 支持多用户，且用户可以通过网页修改代码
- 管理员用户可添加普通用户
- 网页操作均需要进行登陆及权限校验（非登陆状态下不可以访问登陆界面外的任何网页）

#### 3.2 监控及分析

- 可以打开多个摄像头（本地及RTSP协议的网络摄像头）
- 使用`mjpeg`向前端推送视频流
- 对于单帧图像使用`ssd`网络进行物体识别，同时使用图像相似度对比实现物体追踪

####3.3 报警

- 动态划定方形区域作为警报区，如果有物体的进入则发出警报
- 可以通过删除已经出现的警报及查看历史警报

## 4. 网站使用说明

网站主要分为登陆模块和监控模块两部分，结构及关系如下：

![Snipaste_2018-09-14_20-21-40](C:\Users\wuhaixu\Desktop\Snipaste_2018-09-14_20-21-40.png) 

####4.1 登陆

- 进入根目录下的``mysite``文件夹，运行``python manage.py runserver``，访问网址（本机地址）``127.0.0.1:8000/news/home/``，如果已经登陆则直接进入总览，否则进入登陆界面。
- 在登陆界面可以进行修改密码以及注册账号等操作。
- 对于注册账号，我们认为只有管理员才有新建账号权限。在登录界面登录管理员帐号（用户名：``admin``，密码：``123456``）可进入注册界面。输入合法用户名和密码即可注册。注册成功后默认为登出状态，需要重新登录。

#### 4.2 监控

- 只有登陆之后才可以进入总览界面，总览界面可以输入想要访问的摄像头地址，进行打开。如果关闭摄像头则需要回到后台改变数据库信息，或者跳转到别的界面。
- 点击查看详情之后，直接进入细节报警界面。可以在界面上方看到具有bounding box的图像，中部具有填写区域范围的栏目，下方为显示报警区域（可以刷新与清空）。
- 点击细节界面的最上方“查看另一视图”，出现tracking效果，显示物体轨迹点，不同物体颜色不同。

## 5. 文件及技术说明

#### 5.1 文件说明

- `mysite/model_data`存放网络模型

- `mysite/utils`存放网络配置代码

- `mysite/news/`存放项目代码文件

  - `mysite/news/object/`存放图像处理代码：test_ssd_mobilenet.py(物体检测分类网络)以及match.py(图像相似度匹配)

  - `mysite/news/templates/`存放前端界面代码

  - `mysite/news/views/`存放request响应处理代码

#### 5.2 技术说明

##### 5.2.1 视频流处理

使用streamingHttpResponse对图像进行视频流推送，播放更加流畅，同时也避免了多余计算资源和内存的占用。

##### 5.2.2 图像处理

使用ssd_mobilenet进行图像检测和分类，同时使用图像相似度对比的方式，计算两张图像的相似度，从而与识别出来的物体对比，如果一致则使用同一颜色的轨迹点进行记录。

##### 5.2.3 提升效率

为提升处理效率以及运行效果。我们使用如下方式：

- 将监控内容运行在不同的线程下，提升响应速度。
- 提前加载网络参数，减少视频加载时间。
- 每相隔五帧图像，选取一张进行处理，提升视频流畅度。（帧率平均为24fps）

## 6. 运行示例

关于上述功能的效果，我们录制视频见压缩包。

## 7. 作者



##引用

参考网址及文档如下：

https://github.com/kaka-lin/object-detection  使用其ssd_mobilenet部分

https://blog.csdn.net/haofan_/article/details/78806143 使用文中方法计算图像相似度

https://docs.djangoproject.com/zh-hans/2.0/ 参考理解数据库及用户管理